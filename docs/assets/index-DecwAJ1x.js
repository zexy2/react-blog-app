import{a9 as e,u as s,t as a,e as t,r as l,j as i,aa as n,ab as d,U as r,S as c,ac as o,z as m,ad as h,ae as u,af as _}from"./index-CIFma0KW.js";const b="postify_posts",x=()=>{const e=localStorage.getItem(b);return e?JSON.parse(e):[]},j=e=>{localStorage.setItem(b,JSON.stringify(e))},N={checkAdminAuth:async()=>{if(!(await e.isAdmin()))throw new Error("Admin yetkisi gerekiyor");return!0},getDashboardStats:async()=>(await N.checkAdminAuth(),e.getDashboardStats()),getAllUsers:async()=>(await N.checkAdminAuth(),e.getAllUsers()),updateUserRole:async(s,a)=>(await N.checkAdminAuth(),e.updateUserRole(s,a)),deleteUser:async s=>(await N.checkAdminAuth(),e.deleteUser(s)),getAllPosts:async()=>{await N.checkAdminAuth(),await new Promise(e=>setTimeout(e,300));return x().map(e=>({...e,_admin:{canEdit:!0,canDelete:!0,canModerate:!0}}))},deletePost:async e=>{await N.checkAdminAuth(),await new Promise(e=>setTimeout(e,300));const s=x().filter(s=>s.id!==e&&s.id!==Number(e));return j(s),{success:!0}},updatePost:async(s,a)=>{await N.checkAdminAuth(),await new Promise(e=>setTimeout(e,300));const t=x(),l=t.findIndex(e=>e.id===s||e.id===Number(s));if(-1===l)throw new Error("Post bulunamadı");return t[l]={...t[l],...a,updatedAt:(new Date).toISOString(),_moderatedBy:(await e.getSession())?.user?.id},j(t),t[l]},togglePostVisibility:async e=>{await N.checkAdminAuth(),await new Promise(e=>setTimeout(e,300));const s=x(),a=s.findIndex(s=>s.id===e||s.id===Number(e));if(-1===a)throw new Error("Post bulunamadı");return s[a].isPublished=!s[a].isPublished,s[a].updatedAt=(new Date).toISOString(),j(s),s[a]},getSystemLogs:async()=>(await N.checkAdminAuth(),[{id:1,action:"USER_LOGIN",user:"admin",timestamp:(new Date).toISOString(),details:"Successful login"},{id:2,action:"POST_CREATED",user:"user1",timestamp:new Date(Date.now()-36e5).toISOString(),details:"New post created"},{id:3,action:"USER_REGISTERED",user:"newuser",timestamp:new Date(Date.now()-72e5).toISOString(),details:"New user registration"}])},p={container:"_container_blmd8_5",header:"_header_blmd8_12",headerIcon:"_headerIcon_blmd8_27",tabs:"_tabs_blmd8_37",tab:"_tab_blmd8_37",active:"_active_blmd8_65",statsGrid:"_statsGrid_blmd8_71",statCard:"_statCard_blmd8_78",statIcon:"_statIcon_blmd8_94",statInfo:"_statInfo_blmd8_102",statNumber:"_statNumber_blmd8_107",statLabel:"_statLabel_blmd8_113",recentSection:"_recentSection_blmd8_119",recentList:"_recentList_blmd8_132",recentItem:"_recentItem_blmd8_138",avatar:"_avatar_blmd8_150",userInfo:"_userInfo_blmd8_157",userName:"_userName_blmd8_163",userEmail:"_userEmail_blmd8_168",roleBadge:"_roleBadge_blmd8_174",admin:"_admin_blmd8_182",moderator:"_moderator_blmd8_187",user:"_user_blmd8_157",table:"_table_blmd8_198",userCell:"_userCell_blmd8_230",tableAvatar:"_tableAvatar_blmd8_236",roleSelect:"_roleSelect_blmd8_242",statusBadge:"_statusBadge_blmd8_258",published:"_published_blmd8_265",draft:"_draft_blmd8_270",actions:"_actions_blmd8_276",actionBtn:"_actionBtn_blmd8_281",deleteBtn:"_deleteBtn_blmd8_300",postTitle:"_postTitle_blmd8_330",loading:"_loading_blmd8_338",error:"_error_blmd8_344",noPosts:"_noPosts_blmd8_353"},g=()=>{const{t:b}=s(),x=a(),{user:j}=t(e=>e.user),[g,w]=l.useState("dashboard"),[S,y]=l.useState(null),[A,f]=l.useState([]),[v,I]=l.useState([]),[P,k]=l.useState(!0),[D,C]=l.useState(null);l.useEffect(()=>{(async()=>{await e.isAdmin()||x("/")})()},[x]),l.useEffect(()=>{(async()=>{k(!0),C(null);try{if("dashboard"===g){const e=await N.getDashboardStats();y(e)}else if("users"===g){const e=await N.getAllUsers();f(e)}else if("posts"===g){const e=await N.getAllPosts();I(e)}}catch(e){C(e.message)}finally{k(!1)}})()},[g]);return P&&"dashboard"===g&&!S?i.jsx("div",{className:p.container,children:i.jsx("div",{className:p.loading,children:"Yükleniyor..."})}):i.jsxs("div",{className:p.container,children:[i.jsxs("div",{className:p.header,children:[i.jsxs("h1",{children:[i.jsx(n,{className:p.headerIcon}),"Admin Panel"]}),i.jsxs("p",{children:["Hoş geldiniz, ",j?.user_metadata?.full_name||"Admin"]})]}),i.jsxs("div",{className:p.tabs,children:[i.jsxs("button",{className:`${p.tab} ${"dashboard"===g?p.active:""}`,onClick:()=>w("dashboard"),children:[i.jsx(d,{})," Dashboard"]}),i.jsxs("button",{className:`${p.tab} ${"users"===g?p.active:""}`,onClick:()=>w("users"),children:[i.jsx(r,{})," Kullanıcılar"]}),i.jsxs("button",{className:`${p.tab} ${"posts"===g?p.active:""}`,onClick:()=>w("posts"),children:[i.jsx(c,{})," Postlar"]})]}),D&&i.jsx("div",{className:p.error,children:D}),i.jsx("div",{className:p.content,children:P?i.jsx("div",{className:p.loading,children:"Yükleniyor..."}):i.jsxs(i.Fragment,{children:["dashboard"===g&&i.jsxs("div",{className:p.dashboard,children:[i.jsx("h2",{children:"Dashboard"}),S&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:p.statsGrid,children:[i.jsxs("div",{className:p.statCard,children:[i.jsx(r,{className:p.statIcon}),i.jsxs("div",{className:p.statInfo,children:[i.jsx("span",{className:p.statNumber,children:S.totalUsers}),i.jsx("span",{className:p.statLabel,children:"Toplam Kullanıcı"})]})]}),i.jsxs("div",{className:p.statCard,children:[i.jsx(c,{className:p.statIcon}),i.jsxs("div",{className:p.statInfo,children:[i.jsx("span",{className:p.statNumber,children:S.totalPosts}),i.jsx("span",{className:p.statLabel,children:"Toplam Post"})]})]}),i.jsxs("div",{className:p.statCard,children:[i.jsx(n,{className:p.statIcon}),i.jsxs("div",{className:p.statInfo,children:[i.jsx("span",{className:p.statNumber,children:S.adminCount}),i.jsx("span",{className:p.statLabel,children:"Admin"})]})]}),i.jsxs("div",{className:p.statCard,children:[i.jsx(d,{className:p.statIcon}),i.jsxs("div",{className:p.statInfo,children:[i.jsx("span",{className:p.statNumber,children:S.moderatorCount}),i.jsx("span",{className:p.statLabel,children:"Moderatör"})]})]})]}),i.jsxs("div",{className:p.recentSection,children:[i.jsx("h3",{children:"Son Kayıt Olan Kullanıcılar"}),i.jsx("ul",{className:p.recentList,children:S.recentUsers?.map(e=>i.jsxs("li",{className:p.recentItem,children:[i.jsx("img",{src:e.user_metadata?.avatar_url,alt:e.user_metadata?.username,className:p.avatar}),i.jsxs("div",{className:p.userInfo,children:[i.jsx("span",{className:p.userName,children:e.user_metadata?.full_name}),i.jsx("span",{className:p.userEmail,children:e.email})]}),i.jsx("span",{className:`${p.roleBadge} ${p[e.role]}`,children:e.role})]},e.id))})]})]})]}),"users"===g&&i.jsxs("div",{className:p.usersSection,children:[i.jsx("h2",{children:"Kullanıcı Yönetimi"}),i.jsxs("table",{className:p.table,children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Kullanıcı"}),i.jsx("th",{children:"E-posta"}),i.jsx("th",{children:"Rol"}),i.jsx("th",{children:"Kayıt Tarihi"}),i.jsx("th",{children:"İşlemler"})]})}),i.jsx("tbody",{children:A.map(e=>i.jsxs("tr",{children:[i.jsx("td",{children:i.jsxs("div",{className:p.userCell,children:[i.jsx("img",{src:e.user_metadata?.avatar_url,alt:e.user_metadata?.username,className:p.tableAvatar}),i.jsx("span",{children:e.user_metadata?.full_name||e.user_metadata?.username})]})}),i.jsx("td",{children:e.email}),i.jsx("td",{children:i.jsxs("select",{value:e.role||o.USER,onChange:s=>(async(e,s)=>{try{await N.updateUserRole(e,s),f(A.map(a=>a.id===e?{...a,role:s}:a))}catch(a){alert(a.message)}})(e.id,s.target.value),className:p.roleSelect,disabled:e.id===j?.id,children:[i.jsx("option",{value:o.USER,children:"User"}),i.jsx("option",{value:o.MODERATOR,children:"Moderator"}),i.jsx("option",{value:o.ADMIN,children:"Admin"})]})}),i.jsx("td",{children:new Date(e.created_at).toLocaleDateString("tr-TR")}),i.jsx("td",{children:i.jsx("button",{onClick:()=>(async e=>{if(window.confirm("Bu kullanıcıyı silmek istediğinizden emin misiniz?"))try{await N.deleteUser(e),f(A.filter(s=>s.id!==e))}catch(s){alert(s.message)}})(e.id),className:p.deleteBtn,disabled:e.id===j?.id,title:"Kullanıcıyı Sil",children:i.jsx(m,{})})})]},e.id))})]})]}),"posts"===g&&i.jsxs("div",{className:p.postsSection,children:[i.jsx("h2",{children:"Post Moderasyonu"}),0===v.length?i.jsx("p",{className:p.noPosts,children:"Henüz post bulunmuyor."}):i.jsxs("table",{className:p.table,children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Başlık"}),i.jsx("th",{children:"Yazar"}),i.jsx("th",{children:"Tarih"}),i.jsx("th",{children:"Durum"}),i.jsx("th",{children:"İşlemler"})]})}),i.jsx("tbody",{children:v.map(e=>i.jsxs("tr",{children:[i.jsx("td",{className:p.postTitle,children:e.title}),i.jsx("td",{children:e.author||"Anonim"}),i.jsx("td",{children:new Date(e.createdAt||e.created_at||Date.now()).toLocaleDateString("tr-TR")}),i.jsx("td",{children:i.jsx("span",{className:`${p.statusBadge} ${!1!==e.isPublished?p.published:p.draft}`,children:!1!==e.isPublished?"Yayında":"Taslak"})}),i.jsxs("td",{className:p.actions,children:[i.jsx("button",{onClick:()=>(async e=>{try{const s=await N.togglePostVisibility(e);I(v.map(a=>a.id===e?s:a))}catch(s){alert(s.message)}})(e.id),className:p.actionBtn,title:!1!==e.isPublished?"Yayından Kaldır":"Yayınla",children:!1!==e.isPublished?i.jsx(h,{}):i.jsx(u,{})}),i.jsx("button",{onClick:()=>x(`/posts/${e.id}/edit`),className:p.actionBtn,title:"Düzenle",children:i.jsx(_,{})}),i.jsx("button",{onClick:()=>(async e=>{if(window.confirm("Bu postu silmek istediğinizden emin misiniz?"))try{await N.deletePost(e),I(v.filter(s=>s.id!==e))}catch(s){alert(s.message)}})(e.id),className:p.deleteBtn,title:"Sil",children:i.jsx(m,{})})]})]},e.id))})]})]})]})})]})};export{g as default};
