import{_ as e,$ as a,a0 as s,u as t,t as i,a1 as l,r,j as n,a2 as o,a3 as c,a4 as d,a5 as m,a6 as p}from"./index-CIFma0KW.js";const u="post-images",f=5242880,h=["image/jpeg","image/png","image/gif","image/webp"],_={uploadImage:async(a,t="posts")=>{if(!h.includes(a.type))throw new Error("Invalid file type. Only JPEG, PNG, GIF, and WebP are allowed.");if(a.size>f)throw new Error("File size exceeds 5MB limit.");const i=a.name.split(".").pop(),l=`${t}/${`${s()}.${i}`}`,r=await e.upload(u,l,a,{contentType:a.type});return{path:l,url:e.getPublicUrl(u,l),...r}},uploadImages:async(e,a="posts")=>await Promise.all(e.map(e=>_.uploadImage(e,a))),deleteImage:async a=>e.delete(u,[a]),deleteImages:async a=>e.delete(u,a),getImageUrl:a=>e.getPublicUrl(u,a),uploadAvatar:async(s,t)=>{const i=`avatars/${`${t}.${s.name.split(".").pop()}`}`;await e.upload("avatars",i,s,{contentType:s.type,upsert:!0});const l=e.getPublicUrl("avatars",i);return await a.from("profiles").update({avatar_url:l}).eq("id",t),l},getFileInfo:e=>({name:e.name,size:e.size,type:e.type,sizeFormatted:_.formatFileSize(e.size),isValid:h.includes(e.type)&&e.size<=f}),formatFileSize:e=>{if(0===e)return"0 Bytes";const a=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,a)).toFixed(2))+" "+["Bytes","KB","MB","GB"][a]}},x={container:"_container_1wtyk_6",loading:"_loading_1wtyk_13",spinner:"_spinner_1wtyk_20",profileCard:"_profileCard_1wtyk_34",header:"_header_1wtyk_55",avatarSection:"_avatarSection_1wtyk_72",avatarWrapper:"_avatarWrapper_1wtyk_78",avatar:"_avatar_1wtyk_72",avatarUpload:"_avatarUpload_1wtyk_109",headerInfo:"_headerInfo_1wtyk_137",name:"_name_1wtyk_144",username:"_username_1wtyk_151",email:"_email_1wtyk_157",editButton:"_editButton_1wtyk_185",form:"_form_1wtyk_276",formRow:"_formRow_1wtyk_297",formGroup:"_formGroup_1wtyk_303",input:"_input_1wtyk_319",textarea:"_textarea_1wtyk_348",saveButton:"_saveButton_1wtyk_387"},v=()=>{const{t:e}=t(),a=i(),{user:s,isAuthenticated:u,isLoading:f,updateProfile:h}=l(),[v,j]=r.useState(!1),[w,y]=r.useState(!0),[g,b]=r.useState({full_name:"",username:"",bio:"",website:"",location:""}),[N,k]=r.useState(!1);r.useEffect(()=>{const e=setTimeout(()=>{y(!1)},2e3);return()=>clearTimeout(e)},[]),r.useEffect(()=>{f||y(!1)},[f]),r.useEffect(()=>{w||u||a("/auth/login")},[w,u,a]),r.useEffect(()=>{const e=s?.profile||s?.user_metadata;e&&b({full_name:e.full_name||"",username:e.username||"",bio:e.bio||"",website:e.website||"",location:e.location||""})},[s]);const I=e=>{const{name:a,value:s}=e.target;b(e=>({...e,[a]:s}))};if(w&&!s)return n.jsx("div",{className:x.loading,children:n.jsx("div",{className:x.spinner})});if(!s)return n.jsx("div",{className:x.loading,children:n.jsx("p",{children:"Kullanıcı bulunamadı. Lütfen giriş yapın."})});const B=s.profile||s.user_metadata||{},G=B.full_name||B.name||s.email?.split("@")[0]||"Kullanıcı",S=B.username||s.email?.split("@")[0]||"user",C=B.avatar_url||`https://api.dicebear.com/7.x/avataaars/svg?seed=${s.email}`;return n.jsx("div",{className:x.container,children:n.jsxs("div",{className:x.profileCard,children:[n.jsxs("div",{className:x.header,children:[n.jsx("div",{className:x.avatarSection,children:n.jsxs("div",{className:x.avatarWrapper,children:[n.jsx("img",{src:C,alt:G,className:x.avatar}),n.jsxs("label",{className:x.avatarUpload,children:[n.jsx("input",{type:"file",accept:"image/*",onChange:async a=>{const t=a.target.files?.[0];if(t)try{k(!0);const a=await _.uploadAvatar(t,s.id);await h({avatar_url:a}),p.success(e("profile.avatarUpdated"))}catch(i){p.error(i.message||e("profile.avatarError"))}finally{k(!1)}},disabled:N,hidden:!0}),n.jsx(o,{})]})]})}),n.jsxs("div",{className:x.headerInfo,children:[n.jsx("h1",{className:x.name,children:G}),n.jsxs("p",{className:x.username,children:["@",S]}),n.jsx("p",{className:x.email,children:s.email})]}),n.jsxs("button",{className:x.editButton,onClick:()=>j(!v),children:[v?n.jsx(c,{}):n.jsx(d,{}),e(v?"common.cancel":"profile.edit")]})]}),v?n.jsxs("div",{className:x.form,children:[n.jsxs("div",{className:x.formRow,children:[n.jsxs("div",{className:x.formGroup,children:[n.jsx("label",{children:e("auth.fullName")}),n.jsx("input",{type:"text",name:"full_name",value:g.full_name,onChange:I,className:x.input})]}),n.jsxs("div",{className:x.formGroup,children:[n.jsx("label",{children:e("auth.username")}),n.jsx("input",{type:"text",name:"username",value:g.username,onChange:I,className:x.input})]})]}),n.jsxs("div",{className:x.formGroup,children:[n.jsx("label",{children:e("profile.bio")}),n.jsx("textarea",{name:"bio",value:g.bio,onChange:I,className:x.textarea,rows:4,placeholder:e("profile.bioPlaceholder")})]}),n.jsxs("div",{className:x.formRow,children:[n.jsxs("div",{className:x.formGroup,children:[n.jsx("label",{children:e("profile.website")}),n.jsx("input",{type:"url",name:"website",value:g.website,onChange:I,className:x.input,placeholder:"https://"})]}),n.jsxs("div",{className:x.formGroup,children:[n.jsx("label",{children:e("profile.location")}),n.jsx("input",{type:"text",name:"location",value:g.location,onChange:I,className:x.input,placeholder:e("profile.locationPlaceholder")})]})]}),n.jsxs("button",{className:x.saveButton,onClick:async()=>{(await h(g)).success&&j(!1)},children:[n.jsx(m,{}),e("common.save")]})]}):n.jsxs("div",{className:x.info,children:[B.bio&&n.jsxs("div",{className:x.infoSection,children:[n.jsx("h3",{children:e("profile.bio")}),n.jsx("p",{children:B.bio})]}),n.jsxs("div",{className:x.infoGrid,children:[B.website&&n.jsxs("div",{className:x.infoItem,children:[n.jsx("span",{className:x.infoLabel,children:e("profile.website")}),n.jsx("a",{href:B.website,target:"_blank",rel:"noopener noreferrer",children:B.website})]}),B.location&&n.jsxs("div",{className:x.infoItem,children:[n.jsx("span",{className:x.infoLabel,children:e("profile.location")}),n.jsx("span",{children:B.location})]}),n.jsxs("div",{className:x.infoItem,children:[n.jsx("span",{className:x.infoLabel,children:e("profile.memberSince")}),n.jsx("span",{children:new Date(s.created_at||Date.now()).toLocaleDateString()})]})]})]})]})})};export{v as default};
